<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: layout(~{::content})}" xmlns:sec="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title th:text="'Chi tiết Tour - ' + ${id.tieuDe}">Chi tiết Tour</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

</head>
<body>
<th:block th:fragment="content">
    <div class="container pt-5 tour-detail-container">
        <div class="row" style="margin-top:30px;">

            <div class="col-lg-8">

                <h1 class="h4 fw-bold" th:text="${id.tieuDe}">
                </h1>
                <hr>

                <div class="row g-2">
                    <div class="col-3 d-flex flex-column justify-content-start">
                        <img src="https://s3-cmc.travel.com.vn/vtv-image/Images/Tour/tfd__0_11904_hoa-do-quyen-do.webp" class="img-fluid rounded mb-2 border" alt="Ảnh nhỏ 1">
                        <img src="https://s3-cmc.travel.com.vn/vtv-image/Images/Tour/tfd__1_11904_the-village-cat-cat-in-sapa.webp" class="img-fluid rounded mb-2 border" alt="Ảnh nhỏ 2">
                        <img src="https://s3-cmc.travel.com.vn/vtv-image/Images/Tour/tfd__2_11904_beautiful-landscape-with-mountain-view-on-the-train-1.webp" class="img-fluid rounded mb-2 border" alt="Ảnh nhỏ 3">
                    </div>
                    <div class="col-9">
                        <img th:src="${id.hinhAnh}" class="img-fluid rounded" alt="Ảnh chính Tour">
                    </div>
                </div>
                <div class="card-header bg-white border-0 ps-0">

                    <h2 class="h5 fw-bold">LỊCH KHỞI HÀNH</h2>
                </div>
                <div class="card-body p-0">
                    <div class="row g-0">
                        <div class="col-3 col-md-2 pe-3">
                            <div th:each="m : ${ {1, 2, 3} }">
                                <a th:href="@{/tour/{id}(id=${id.id}, month=${m}, year=2026)}"
                                   class="btn w-100 mb-2 small fw-bold"
                                   th:classappend="${m == currentMonth} ? 'btn-warning active' : 'btn-outline-light border text-dark'"
                                   th:text="${#numbers.formatInteger(m,2)} + '/2026'">
                                </a>
                            </div>
                        </div>

                        <div class="col-9 col-md-10 border rounded p-3 bg-white shadow-sm">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <a th:href="@{/tour/{id}(id=${id.id}, month=${(currentMonth ?: 1) == 1 ? 12 : (currentMonth ?: 1) - 1}, year=${(currentMonth ?: 1) == 1 ? (currentYear ?: 2026) - 1 : (currentYear ?: 2026)})}"
                                   class="btn btn-sm btn-light border-0">
                                    <i class="bi bi-chevron-left"></i>
                                </a>
                                <span class="fw-bold text-uppercase" th:text="'Tháng ' + ${#numbers.formatInteger(currentMonth ?: 1, 2)} + '/' + ${currentYear ?: 2026}"></span>
                                <a th:href="@{/tour/{id}(id=${id.id}, month=${(currentMonth ?: 1) == 12 ? 1 : (currentMonth ?: 1) + 1}, year=${(currentMonth ?: 1) == 12 ? (currentYear ?: 2026) + 1 : (currentYear ?: 2026)})}"
                                   class="btn btn-sm btn-light border-0">
                                    <i class="bi bi-chevron-right"></i>
                                </a>
                            </div>

                            <div class="calendar-grid">
                                <div class="day-label">T2</div>
                                <div class="day-label">T3</div>
                                <div class="day-label">T4</div>
                                <div class="day-label">T5</div>
                                <div class="day-label">T6</div>
                                <div class="day-label">T7</div>
                                <div class="day-label text-danger">CN</div>

                                <th:block th:each="day : ${calendar}">
                                    <a th:href="${day.isPast} ? 'javascript:void(0)' : @{/tour/{id}(id=${id.id}, month=${currentMonth}, year=${currentYear}, selectedDate=${day.date})}"
                                       class="calendar-day text-decoration-none text-dark"
                                       th:classappend="${day.isSelected ? 'active-day' : ''}
                     + ${!day.isCurrentMonth ? ' other-month' : ''}+ ${day.isPast ? ' disabled-day' : ''}">
                                        <span class="day-num" th:text="${day.date.dayOfMonth}"></span>
                                        <span class="price-sub" th:if="${!day.isPast and day.isSelected and price > 0}"
                                              th:text="${#numbers.formatDecimal(price/1000, 0, 'POINT', 0, 'POINT')} + 'K'">
        </span>
                                    </a>
                                </th:block>
                            </div>

                            <p class="text-center text-danger mt-4 small italic">
                                <i class="bi bi-info-circle me-1"></i> Quý khách vui lòng chọn ngày phù hợp
                            </p>
                        </div>
                    </div>
                </div>


                <div class="mt-4 p-3 bg-light rounded border-start border-3 border-primary">
                    <h3 class="h6 text-primary fw-bold">Điểm nhấn của chương trình</h3>
                    <p class="small mb-0 text-muted h7" th:text="${id.highlight}">
                        <a href="#" class="text-primary small fw-bold">Xem thêm</a>
                    </p>
                </div>

                <hr>

                <h3 class="h5 fw-bold text-center mt-4 mb-3">THÔNG TIN THÊM VỀ CHUYẾN ĐI</h3>
                <div class="row text-center border-bottom pb-3 mb-3">
                    <div class="col-4">
                        <i class="bi bi-geo-alt fs-4 text-primary"></i>
                        <p class="mb-1 fw-bold small">Điểm tham quan</p>
                        <p class="small text-muted" th:text="${id.moTa}"></p>
                    </div>
                    <div class="col-4">
                        <i class="bi bi-bus-front fs-4 text-primary"></i>
                        <p class="mb-1 fw-bold small" >Phương Tiện</p>
                        <p class="small text-muted" th:text="${id.idPhuongTien.loai}"></p>
                    </div>
                    <div class="col-4">
                        <i class="bi bi-people fs-4 text-primary"></i>
                        <p class="mb-1 fw-bold small">Đối tượng thích hợp</p>
                        <p class="small text-muted">Cặp đôi, Gia đình, Thanh niên</p>
                    </div>
                </div>

            </div>

            <div class="col-lg-4">
                <div class="card border-0 shadow-sm p-3 sticky-price-box">
                    <div class="card-body">
                        <p class="mb-0 text-secondary small">Giá từ:</p>
                        <h2 class="card-title text-danger fw-bold" th:text="${#numbers.formatDecimal(id.gia+price, 0, 'COMMA', 0, 'POINT')} + ' VND'">

                            <span class="small text-secondary">/Khách</span>
                        </h2>
<!--                        <p class="small text-muted mb-3">Mã chương trình: NDSGN1965</p>-->
                        <p class="small text-muted mb-3">
                            Khởi hành: <strong th:text="${origin}"></strong>
                        </p>
                        <p class="small text-muted mb-3">
                            Ngày khởi hành: <strong th:text="${date}"></strong>
                        </p>
                        <p class="small text-muted mb-3">
                            Mã chuyến bay:<strong th:text="${carrier}"></strong>
                        </p>
                        <p class="small text-muted mb-3"></p>

                        <button class="btn btn-primary w-100 mb-2 py-2 fw-bold">
                            <i class="bi bi-calendar-check me-2"></i> Chọn ngày khởi hành
                        </button>
                        <a sec:authorize="isAnonymous()"
                           th:href="@{/login}"
                           class="btn btn-outline-secondary w-100 py-2 fw-bold text-decoration-none">
                            <i class="bi bi-heart me-2"></i> Lưu lại chuyến đi
                        </a>
                        <button sec:authorize="isAuthenticated()"
                                class="btn btn-outline-secondary w-100 py-2 fw-bold"
                                onclick="saveTour()"> <i class="bi bi-heart me-2"></i> Lưu lại chuyến đi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>
</body>

</html>