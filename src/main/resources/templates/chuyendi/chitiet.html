<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: layout(~{::content})}">

<head>
    <meta charset="UTF-8">
    <title th:text="'Chi tiết Tour - ' + ${id.tieuDe}">Chi tiết Tour</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

</head>
<body>
<th:block th:fragment="content">
    <div class="container pt-5 tour-detail-container">
        <div class="row" style="margin-top:30px;">

            <div class="col-lg-8">

                <h1 class="h4 fw-bold" th:text="${id.tieuDe}">
                </h1>
                <hr>

                <div class="row g-2">
                    <div class="col-3 d-flex flex-column justify-content-start">
                        <img src="https://s3-cmc.travel.com.vn/vtv-image/Images/Tour/tfd__0_11904_hoa-do-quyen-do.webp" class="img-fluid rounded mb-2 border" alt="Ảnh nhỏ 1">
                        <img src="https://s3-cmc.travel.com.vn/vtv-image/Images/Tour/tfd__1_11904_the-village-cat-cat-in-sapa.webp" class="img-fluid rounded mb-2 border" alt="Ảnh nhỏ 2">
                        <img src="https://s3-cmc.travel.com.vn/vtv-image/Images/Tour/tfd__2_11904_beautiful-landscape-with-mountain-view-on-the-train-1.webp" class="img-fluid rounded mb-2 border" alt="Ảnh nhỏ 3">
                    </div>
                    <div class="col-9">
                        <img th:src="${id.hinhAnh}" class="img-fluid rounded" alt="Ảnh chính Tour">
                    </div>
                </div>
                <div class="card my-4 border-0">
                    <div class="card-header bg-white border-0 ps-0">
                        <h2 class="h5 fw-bold">LỊCH KHỞI HÀNH</h2>
                    </div>
                    <div class="card-body p-0">
                        <div class="row g-0">
                            <div class="col-3 col-md-2 pe-3" id="monthSidebar">
                                <div class="col-3 col-md-2 pe-3">
                                    <div th:each="m : ${ {1, 2, 3} }">
                                        <a th:href="@{/tour/{id}(id=${id.id}, month=${m}, year=2026)}"
                                           class="btn w-100 mb-2 small fw-bold"
                                           th:classappend="${m == currentMonth} ? 'btn-warning active' : 'btn-outline-light border text-dark'"
                                           th:text="${#numbers.formatInteger(m,2)} + '/2026'">
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="col-9 col-md-10 border rounded p-3 bg-white shadow-sm">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <button class="btn btn-sm btn-light border-0" onclick="changeMonth(-1)"><i class="bi bi-chevron-left"></i></button>
                                    <span class="fw-bold text-uppercase" id="calendarTitle">Tháng 01/2026</span>
                                    <button class="btn btn-sm btn-light border-0" onclick="changeMonth(1)"><i class="bi bi-chevron-right"></i></button>
                                </div>
                                <div class="calendar-grid">
                                    <div class="day-label">T2</div>... <th:block th:each="day : ${calendar}">
                                    <a th:href="@{/tour/{id}(id=${id.id}, month=${currentMonth}, year=${currentYear}, selectedDate=${day.date})}"
                                       class="calendar-day text-decoration-none text-dark"
                                       th:classappend="${day.isSelected ? 'active-day' : ''} + ${!day.isCurrentMonth ? ' other-month' : ''}">

                                        <span class="day-num" th:text="${day.date.dayOfMonth}"></span>

                                        <span class="price-sub" th:if="${price > 0}"
                                              th:text="${#numbers.formatDecimal(price/1000, 0, 'POINT', 0, 'POINT')} + 'K'">
            </span>
                                    </a>
                                </th:block>
                                </div>
                                <p class="text-center text-danger mt-4 small italic">
                                    <i class="bi bi-info-circle me-1"></i> Quý khách vui lòng chọn ngày phù hợp
                                </p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="mt-4 p-3 bg-light rounded border-start border-3 border-primary">
                    <h3 class="h6 text-primary fw-bold">Điểm nhấn của chương trình</h3>
                    <p class="small mb-0 text-muted h7" th:text="${id.highlight}">
                        <a href="#" class="text-primary small fw-bold">Xem thêm</a>
                    </p>
                </div>

                <hr>

                <h3 class="h5 fw-bold text-center mt-4 mb-3">THÔNG TIN THÊM VỀ CHUYẾN ĐI</h3>
                <div class="row text-center border-bottom pb-3 mb-3">
                    <div class="col-4">
                        <i class="bi bi-geo-alt fs-4 text-primary"></i>
                        <p class="mb-1 fw-bold small">Điểm tham quan</p>
                        <p class="small text-muted" th:text="${id.moTa}"></p>
                    </div>
                    <div class="col-4">
                        <i class="bi bi-bus-front fs-4 text-primary"></i>
                        <p class="mb-1 fw-bold small" >Phương Tiện</p>
                        <p class="small text-muted" th:text="${id.idPhuongTien.loai}"></p>
                    </div>
                    <div class="col-4">
                        <i class="bi bi-people fs-4 text-primary"></i>
                        <p class="mb-1 fw-bold small">Đối tượng thích hợp</p>
                        <p class="small text-muted">Cặp đôi, Gia đình, Thanh niên</p>
                    </div>
                </div>

            </div>

            <div class="col-lg-4">
                <div class="card border-0 shadow-sm p-3 sticky-price-box">
                    <div class="card-body">
                        <p class="mb-0 text-secondary small">Giá từ:</p>
                        <h2 class="card-title text-danger fw-bold" th:text="${#numbers.formatDecimal(id.gia+price, 0, 'COMMA', 0, 'POINT')} + ' VND'">

                            <span class="small text-secondary">/Khách</span>
                        </h2>
                        <p class="small text-muted mb-3">Mã chương trình: NDSGN1965</p>
                        <p class="small text-muted mb-3">
                            Khởi hành: <strong th:text="${origin}"></strong>
                        </p>
                        <p class="small text-muted mb-3">
                            Ngày khởi hành: <strong th:text="${date}"></strong>
                        </p>
                        <p class="small text-muted mb-3">
                            Mã chuyến bay:<strong th:text="${carrier}"></strong>
                        </p>
                        <p class="small text-muted mb-3"></p>

                        <button class="btn btn-primary w-100 mb-2 py-2 fw-bold">
                            <i class="bi bi-calendar-check me-2"></i> Chọn ngày khởi hành
                        </button>
                        <button class="btn btn-outline-secondary w-100 py-2 fw-bold">
                            <i class="bi bi-heart me-2"></i> Lưu lại chuyến đi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!--    <script th:inline="javascript">-->
<!--        let currentMonth = 1; // Tháng 1-->
<!--        let currentYear = 2026;-->
<!--        let tourBasePrice = [[${price}]];-->
<!--        let currentSelectedDate = "";-->

<!--        document.addEventListener("DOMContentLoaded", function() {-->
<!--            renderMonthSidebar();-->
<!--            renderCalendar(currentMonth, currentYear);-->
<!--        });-->

<!--        function renderMonthSidebar() {-->
<!--            const sidebar = document.getElementById('monthSidebar');-->
<!--            sidebar.innerHTML = '';-->

<!--            // Giả định bạn muốn hiển thị 3 tháng tính từ tháng gốc (ví dụ tháng 1)-->
<!--            // Nếu bạn muốn 3 tháng này là cố định, hãy dùng một biến gốc.-->
<!--            // Ở đây tôi để mặc định hiển thị 3 tháng: 01, 02, 03 của năm 2026 như trong ảnh bạn gửi.-->
<!--            const startM = 1;-->
<!--            const startY = 2026;-->

<!--            for (let i = 0; i < 3; i++) {-->
<!--                let m = startM + i;-->
<!--                let y = startY;-->
<!--                if (m > 12) { m -= 12; y++; }-->

<!--                let btn = document.createElement('button');-->

<!--                // KIỂM TRA ĐIỀU KIỆN ĐỂ TÔ VÀNG:-->
<!--                // Nếu tháng và năm của nút trùng với tháng và năm đang hiển thị trên lịch-->
<!--                const isActive = (m === currentMonth && y === currentYear);-->

<!--                // Nếu active thì dùng class 'btn-warning' (vàng), nếu không thì dùng 'btn-outline-light' (trắng)-->
<!--                btn.className = `btn w-100 mb-2 small fw-bold ${isActive ? 'btn-warning text-dark active' : 'btn-outline-light text-dark border'}`;-->

<!--                btn.innerText = `${String(m).padStart(2,'0')}/${y}`;-->

<!--                btn.onclick = () => {-->
<!--                    currentMonth = m;-->
<!--                    currentYear = y;-->
<!--                    // QUAN TRỌNG: Gọi lại cả 2 hàm để cập nhật lại giao diện nút và lịch-->
<!--                    renderMonthSidebar();-->
<!--                    renderCalendar(m, y);-->
<!--                };-->
<!--                sidebar.appendChild(btn);-->
<!--            }-->
<!--        }-->

<!--        function renderCalendar(month, year) {-->
<!--            const grid = document.getElementById('calendarGrid');-->
<!--            const title = document.getElementById('calendarTitle');-->
<!--            title.innerText = `THÁNG ${String(month).padStart(2, '0')}/${year}`;-->

<!--            // Giữ lại tiêu đề T2-CN-->
<!--            const labels = Array.from(grid.querySelectorAll('.day-label'));-->
<!--            grid.innerHTML = '';-->
<!--            labels.forEach(l => grid.appendChild(l));-->

<!--            const firstDay = new Date(year, month - 1, 1).getDay(); // 0 là Chủ Nhật-->
<!--            const daysInMonth = new Date(year, month, 0).getDate();-->

<!--            // 1. Ô trống tháng trước-->
<!--            let offset = (firstDay === 0) ? 6 : firstDay - 1;-->
<!--            for (let i = 0; i < offset; i++) {-->
<!--                grid.innerHTML += `<div class="calendar-day other-month"></div>`;-->
<!--            }-->

<!--            // 2. Render ngày thực tế-->
<!--            for (let d = 1; d <= daysInMonth; d++) {-->
<!--                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(d).padStart(2, '0')}`;-->
<!--                const dayCell = document.createElement('div');-->
<!--                dayCell.className = 'calendar-day';-->
<!--                dayCell.innerHTML = `<span class="day-num">${d}</span><span class="price-sub" id="p-${dateStr}"></span>`;-->

<!--                dayCell.onclick = () => selectDate(dateStr, dayCell);-->
<!--                grid.appendChild(dayCell);-->
<!--            }-->
<!--        }-->

<!--        // function selectDate(date, element) {-->
<!--        //     // Highlight-->
<!--        //     document.querySelectorAll('.calendar-day').forEach(el => el.classList.remove('active-day'));-->
<!--        //     element.classList.add('active-day');-->
<!--        //     currentSelectedDate = date;-->
<!--        //     document.getElementById('infoDate').innerText = date;-->
<!--        //     const priceLabel = element.querySelector('.price-sub');-->
<!--        //     priceLabel.innerHTML = '<span class="loading-price">...</span>';-->
<!--        //     fetch(`/api/flights/price?origin=SGN&destination=HAN&date=${date}`)-->
<!--        //         .then(res => res.json())-->
<!--        //         .then(data => {-->
<!--        //             const flightPrice = data.price || 0;-->
<!--        //             const total = tourBasePrice + flightPrice;-->
<!--        //-->
<!--        //             // Cập nhật giá lên lịch-->
<!--        //             priceLabel.innerText = (flightPrice / 1000).toFixed(0) + "K";-->
<!--        //-->
<!--        //             // Cập nhật giá tổng bên Box phải-->
<!--        //             document.getElementById('displayTotalPrice').innerText = new Intl.NumberFormat('vi-VN').format(total);-->
<!--        //             document.getElementById('infoCarrier').innerText = data.carrier || "VJ/VN";-->
<!--        //         })-->
<!--        //         .catch(err => {-->
<!--        //             priceLabel.innerText = "Hết vé";-->
<!--        //             console.error(err);-->
<!--        //         });-->
<!--        // }-->
<!--        //-->
<!--        // function changeMonth(step) {-->
<!--        //     currentMonth += step;-->
<!--        //     if (currentMonth > 12) { currentMonth = 1; currentYear++; }-->
<!--        //     if (currentMonth < 1) { currentMonth = 12; currentYear&#45;&#45;; }-->
<!--        //     renderCalendar(currentMonth, currentYear);-->
<!--        // }-->
<!--    </script>-->
</th:block>
</body>

</html>